#
#  Circle CI > Heroku
#  deploy /build folder
#
#

machine:
  timezone: Asia/Tokyo

checkout:
  post:
    - git clone https://github.com/nulltask/heroku-static-provider dist

dependencies:
  pre:
    - go get -v github.com/spf13/hugo

deployment:
  production:
    branch: master
    commands:
      - hugo version
      - hugo
      - cp -r public/* dist/public/
      - cd dist
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - git push git@heroku.com:hugo-sample.git $CIRCLE_SHA1:refs/heads/master
#      - git subtree push --prefix dist git@heroku.com:hugo-sample.git master
      # distフォルダ以下をherokuにdeployする

