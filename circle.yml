machine:
  timezone: Asia/Tokyo

checkout:
  post:
    - git clone https://github.com/nulltask/heroku-static-provider heroku-static-provider

dependencies:
  pre:
    - go get -v github.com/spf13/hugo

deployment:
  production:
    branch: master
    commands:
      - hugo version
      - hugo
      - cp -r public/* heroku-static-provider/public/
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - heroku maintenance:on --app lower-poppy-5174
      - git subtree push --prefix heroku-static-provider git@heroku.com:lower-poppy-5174.git $CIRCLE_SHA1:refs/heads/master
      - heroku maintenance:off --app lower-poppy-5174