machine:
  timezone: Asia/Tokyo

checkout:
  post:
    - git clone https://github.com/nulltask/heroku-static-provider heroku-static-provider

dependencies:
  pre:
    - go get -v github.com/spf13/hugo

deployment:
  production:
    branch: master
    commands:
      - hugo version
      - hugo
      - cp -r public/* heroku-static-provider/public/
      - ls heroku-static-provider
      - heroku maintenance:on --app $HEROKU_APP_NAME
      - heroku scale worker=0 --app $HEROKU_APP_NAME
      - git push git@heroku.com:$HEROKU_APP_NAME.git $CIRCLE_SHA1:refs/heads/master
      - heroku scale worker=x --app $HEROKU_APP_NAME
      - heroku maintenance:off --app $HEROKU_APP_NAME